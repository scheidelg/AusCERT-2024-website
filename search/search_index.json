{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the Electronic Workbook (EWB)","text":"<p>This EWB provides the step-by-step instructions to complete the AusCERT 2024 Security in an (Unmanaged) Azure Environment - A Practical Example workshop.</p>"},{"location":"#synopsis","title":"Synopsis","text":"<p>We've all been there. A team is lured by a shiny gadget or tool that promises to - and maybe actually does! - improve business outcomes and user satisfaction  while reducing cost, development time, and integration headaches, and so boldy forges ahead! So it is with the fictional organization that is at the heart of this workshop, where a group of developers have started building out Azure Microsoft Entra ID applications but haven't followed the organization's technical review or change control processes. And as a result, have potentially introduced operational and security issues into the production environment.</p> <p>In this workshop, we'll take on the role of a security architect that has been tasked with examining this unmanaged Azure environment by replicating and probing the environment for security issues, so that we can demonstrate security issues to the over-zealous developers and bring them back into the fold.</p>"},{"location":"#scenario","title":"Scenario","text":"<p>You are a security architect employed by Tyrell Corporation, a large multi-national organization. Tyrell Corp has embraced a multi-cloud cloud service provider (CSP) vendor strategy using AWS for customer-facing marketing and ordering, tracking, and delivery services; Microsoft Entra ID for on-premises infrastructure; and M365 subscriptions for employees to access Exchange Online, OneDrive, and other collaboration tools.</p> <p>Company executives embrace Microsoft products for their ease of use, and Microsoft Entra ID has been deeply integrated into the on-premises data center and remote offices. The CIO, CTO, and VP of Engineering have been pushing to take advantage of Tyrell Corp's existing Azure account and use the Microsoft Identity platform to synchronize with the existing corporate Microsoft Entra ID. Executives also want to investigate potential new applications in Azure.</p> <p>For these reasons, some developers have started building test Azure Microsoft Entra ID applications. However, the developers have not followed technical review or change control policies, and as a result there has not been any oversight involving the Information Security team. The CISO has ordered a security review into some of the recent development work and operational changes within the Azure environment, and has asked for recommendations on improved detection and logging capabilities within the Azure environment.</p> <p>You have been assigned the task of generating a test environment that replicates key aspects of Tyrell Corp's Microsoft Entra ID environment, exploring it for potential security issues, and reporting your findings.</p> <p>So that you can perform that task -- and as a trusted Security Architect and Engineer -- you have been granted the Global Administrator role in an Azure account. This grants you the ability to create and manage a new subscription, and access to all administrative features within the subscription's associated tenant.<sup>1</sup><sup>,</sup><sup>2</sup><sup>,</sup><sup>3</sup></p>"},{"location":"#labs","title":"Labs","text":"<p>The workshop is broken up into a series of 'mini labs' designed to take you through key activities: </p> <ul> <li>Azure Account Setup: Creating or accessing an Azure account and creating a subscription.</li> <li>Azure Environment Setup: Creating a test environment using PurpleCloud and Terraform.</li> <li>Manual Reconnaissance: Performing manual reconnaisance on the environment to identify service principals with excessive privileges.</li> <li>Privilege Escalation: Leveraging discovered service principals to escalate to Global Administrator, to demonstrate the security weakness.</li> <li>Teardown: Tearing down the test environment using Terraform and manual clean-up.</li> </ul>"},{"location":"#requirements","title":"Requirements","text":"<p>To execute the workshop steps yourself, you'll need:</p> <ul> <li> <p>A laptop or computer that is able to access the Internet, specifically Azure cloud services.</p> </li> <li> <p>Either:</p> <ul> <li>Access to an Azure account that you are willing to use to create, configure, and tear down an Azure subscription; or</li> <li>An email address not already associated with an Azure account, and willingness to follow the EWB instructions to set up an Azure account and subscription for that email address.</li> </ul> </li> </ul>"},{"location":"#caveats-disclaimers-and-alarums","title":"Caveats, Disclaimers, and Alarums","text":"The Ever-Changing Web <p>These instructions were successfully tested on 2024.05.15. That said, things are always changing on the Web. Some prompts or visual elements may be slightly different than are presented here, so you may have to make some minor adjustments on the fly. But the labs' step-by-step instructions should be sufficient to get you there!</p> <p>As one specific example: While Microsoft has renamed Azure Active Directory (AAD) to Microsoft Entra ID, some tools and resources - including some that we use and reference in these labs - still reference AAD. Some of those tools and resources will be updated over time to reference Entra ID, and you may notice those changes as you work through the labs.</p> Browser Support <p>You should be able to use any standard web browser. The Step-by-Step Instructions for all the workshop's labs have been tested in Google Chrome, Microsoft Edge, and Firefox; most of the screenshots are from Chrome and Firefox.</p>"},{"location":"#getting-started","title":"Getting Started!","text":"<p>To get started, continue to the Azure Account Setup lab!</p> <p>Credits</p> <p>This workshop is based on a series of bonus labs from the SANS course SEC530: Defensible Security Architecture and Engineering: Implementing Zero Trust for the Hybrid Enterprise.<sup>4</sup> Those labs were in turn based on a SANS blog post by Jason Ostrom,<sup>5</sup> and uses Jason's PurpleCloud tool.<sup>6</sup></p> <ol> <li> <p>Microsoft. (2024, March 15). Azure roles, Azure AD roles, and classic subscription administrator roles. Microsoft Learn. Retrieved May 17, 2024 from https://learn.microsoft.com/en-us/azure/role-based-access-control/rbac-and-directory-admin-roles.\u00a0\u21a9</p> </li> <li> <p>Microsoft. (2024, April 29). Azure AD built-in roles. Microsoft Learn. Retrieved May 17, 2024 from https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference.\u00a0\u21a9</p> </li> <li> <p>Microsoft. (2024, April 29). Azure AD built-in roles: Global Administrator. Microsoft Learn. Retrieved May 17, 2024 from https://docs.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#global-administrator.\u00a0\u21a9</p> </li> <li> <p>SANS Institute. (n.d.) SEC530: Defensible Security Architecture and Engineering: Implementing Zero Trust for the Hybrid Enterprise. SANS. Retrieved May 18, 2024 from https://www.sans.org/cyber-security-courses/defensible-security-architecture-and-engineering/.\u00a0\u21a9</p> </li> <li> <p>Ostrom, Jason. (2021, June 3). Build, Hack, and Defend Azure Identity - An Introduction to PurpleCloud Hybrid + Identity Cyber Range PurpleCloud is a Hybrid + Identity Cyber Security Range built for Azure Cloud with automated deployment scripts. SANS. Retrieved May 18, 2024 from https://www.sans.org/blog/build-hack-defend-azure-identity/.\u00a0\u21a9</p> </li> <li> <p>Ostrom, Jason. (2024, February 18; commit ec010a6a8b0979f2b63e909b3662ce557cc57615). PurpleCloud. Retrieved May 18, 2024 from https://github.com/iknowjason/PurpleCloud.\u00a0\u21a9</p> </li> </ol>"},{"location":"contact/","title":"Contact Info","text":""},{"location":"contact/#greg-scheidel","title":"Greg Scheidel","text":"<p>Email | scheidelg@gmail.com</p> <p>Twitter | @Greg_Scheidel</p>"},{"location":"contact/#affiliations","title":"Affiliations","text":"<p>SANS Institute | SANS Certified Instructor</p> <p>ECS | Chief Cybersecurity Officer, Cyber Division</p>"},{"location":"contact/#bio","title":"Bio","text":"<p>Greg Scheidel has over 25 years of hands-on experience in IT including desktop and server support, network design and implementation, application development and programming, IT service management, IT security, and information assurance. He currently leads a security program providing a full range of IT security services including SOC, incident management, risk management, penetration testing, forensic and malware analysis, cyber threat intelligence, security engineering, audit and policy SMEs. Greg firmly believes IT and security must serve business needs rather than exist for their own sake, and is passionate about teaching others while expanding and honing his own skills.</p> <p>Greg holds over 30 certifications across IT, ITSM, and IT security and for his own amusement obtains certifications directly meeting every 8507.01 role (two roles to go).</p>"},{"location":"info/","title":"Additional Info","text":""},{"location":"info/#credits","title":"Credits","text":"<p>As noted on the EWB home page, this workshop is based on a series of bonus labs from the SANS course SEC530: Defensible Security Architecture and Engineering: Implementing Zero Trust for the Hybrid Enterprise.<sup>1</sup> Those labs were in turn based on a SANS blog post by Jason Ostrom,<sup>2</sup> and uses Jason's PurpleCloud tool.<sup>3</sup> Jason has continued to do great work </p>"},{"location":"info/#more-on-service-principal-abuse","title":"More on Service Principal Abuse","text":"<p>For further reading on service principal abuse pathways, check out the excellent research authored by Andy Robbins<sup>4</sup> and Dirk-jan Mollema<sup>5</sup>.</p>"},{"location":"info/#sec530-defensible-security-architecture-and-engineering-implementing-zero-trust-for-the-hybrid-enterprise","title":"SEC530: Defensible Security Architecture and Engineering: Implementing Zero Trust for the Hybrid Enterprise","text":"<p>Course Description</p> <p>This course is designed to help students build and maintain a truly defensible security architecture, while taking them on a journey towards implementing Zero Trust principles, pillars and capabilities. There will be a heavy focus on leveraging current infrastructure and investment. Students will learn how to assess, re-configure and validate existing technologies to significantly improve their organizations' prevention, detection and response capabilities, augment visibility, reduce attack surface, and even anticipate attacks in innovative ways. The course will also delve into some of the latest technologies and their capabilities, strengths, and weaknesses. You will come away with recommendations and suggestions that will aid in building a robust security infrastructure, layer by layer, across hybrid environments, as you embark on a journey towards Zero Trust.<sup>1</sup></p> <ol> <li> <p>SANS Institute. (n.d.) SEC530: Defensible Security Architecture and Engineering: Implementing Zero Trust for the Hybrid Enterprise. SANS. Retrieved May 18, 2024 from https://www.sans.org/cyber-security-courses/defensible-security-architecture-and-engineering/.\u00a0\u21a9\u21a9</p> </li> <li> <p>Ostrom, Jason. (2021, June 3). Build, Hack, and Defend Azure Identity - An Introduction to PurpleCloud Hybrid + Identity Cyber Range PurpleCloud is a Hybrid + Identity Cyber Security Range built for Azure Cloud with automated deployment scripts. SANS. Retrieved May 18, 2024 from https://www.sans.org/blog/build-hack-defend-azure-identity/.\u00a0\u21a9</p> </li> <li> <p>Ostrom, Jason. (2024, February 18; commit ec010a6a8b0979f2b63e909b3662ce557cc57615). PurpleCloud. Retrieved May 18, 2024 from https://github.com/iknowjason/PurpleCloud.\u00a0\u21a9</p> </li> <li> <p>Robbins, Andy. (2021, October 12). Azure Privilege Escalation via Service Principal Abuse. Medium. Retrieved May 18, 2024 from https://posts.specterops.io/azure-privilege-escalation-via-service-principal-abuse-210ae2be2a5 \u21a9</p> </li> <li> <p>Mollema, Dirk-jan. (2019, September 16). Azure AD privilege escalation - Taking over default application permissions as Application Admin. Retrieved May 18, 2024 from https://dirkjanm.io/azure-ad-privilege-escalation-application-admin \u21a9</p> </li> </ol>"},{"location":"a1/sec530.bonus.a1/","title":"Azure Account Setup","text":"<p>This lab hasn't been released to the workshop yet. But don't worry - We'll get to it later today! </p>"},{"location":"a2/sec530.bonus.a2/","title":"Azure Environment Setup","text":"<p>This lab hasn't been released to the workshop yet. But don't worry - We'll get to it later today! </p>"},{"location":"a3/sec530.bonus.a3/","title":"Azure Manual Reconnaissance","text":"<p>This lab hasn't been released to the workshop yet. But don't worry - We'll get to it later today! </p>"},{"location":"a4/sec530.bonus.a4/","title":"Azure Privilege Escalation","text":"<p>This lab hasn't been released to the workshop yet. But don't worry - We'll get to it later today! </p>"},{"location":"a5/sec530.bonus.a5/","title":"Azure Teardown","text":"<p>This lab hasn't been released to the workshop yet. But don't worry - We'll get to it later today! </p>"}]}

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Electronice Workbook (EWB) For AuCert 2024 Workshop">
      
      
        <meta name="author" content="Greg Scheidel">
      
      
        <link rel="canonical" href="https://auscert-2024.scheidel.net/a5/sec530.bonus.a5/">
      
      
        <link rel="prev" href="../../a4/sec530.bonus.a4/">
      
      
        <link rel="next" href="../../info/">
      
      
      <link rel="icon" href="../../media/tools-indigo.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.22">
    
    
      
        <title>Teardown - AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.732c4fb1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 9H7V7h10m0 6H7v-2h10m-3 6H7v-2h7M12 3a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m7 0h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z"/></svg>');--md-admonition-icon--cmd:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 10h-2V8h2m0 5h-2v-2h2m-3-1h-2V8h2m0 5h-2v-2h2m0 6H8v-2h8m-9-5H5V8h2m0 5H5v-2h2m1 0h2v2H8m0-5h2v2H8m3 1h2v2h-2m0-5h2v2h-2m9-5H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15h6v2h-6v-2M9 7H7v2h2V7m2 6h6v-2h-6v2m0-4h6V7h-6v2m-2 2H7v2h2v-2m12-6v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-2 0H5v14h14V5M9 15H7v2h2v-2Z"/></svg>');--md-admonition-icon--reminder:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.25 3c.65 0 1.25.21 1.75.56V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.57c.5-.35 1.1-.57 1.75-.57a3 3 0 0 1 3 3c0 1.58-1.21 2.87-2.75 3h-2v1h1.24l.48.13 4.59 2.29c.82.31 1.22.92 1.22 1.83l-.03.14v.14l-1 6.75c-.06.47-.28.88-.66 1.22-.37.34-.79.5-1.26.5H10c-.55 0-1-.19-1.42-.59L2 15.84l1.05-1.07c.28-.27.64-.43 1.08-.43h.32l4.55.99V9H7a3.021 3.021 0 0 1-2.75-3 3 3 0 0 1 3-3M9 6a1.75 1.75 0 0 0-1.75-1.75A1.75 1.75 0 0 0 5.5 6c0 .88.65 1.61 1.5 1.73v.02h2V6m6 1.75v-.01c.85-.12 1.5-.85 1.5-1.74 0-.96-.78-1.74-1.75-1.74S13 5.04 13 6v1.75h2Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-teardown" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example" class="md-header__button md-logo" aria-label="AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example" data-md-component="logo">
      
  <img src="../../media/tools.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Teardown
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../a1/sec530.bonus.a1/" class="md-tabs__link">
          
  
    
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../info/" class="md-tabs__link">
        
  
    
  
  Additional Info

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contact/" class="md-tabs__link">
        
  
    
  
  Contact Info

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example" class="md-nav__button md-logo" aria-label="AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example" data-md-component="logo">
      
  <img src="../../media/tools.svg" alt="logo">

    </a>
    AusCERT 2024 - Security in an (Unmanaged) Azure Environment - A Practical Example
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a1/sec530.bonus.a1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Account Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/sec530.bonus.a2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Environment Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a3/sec530.bonus.a3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual Reconnaissance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a4/sec530.bonus.a4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Teardown
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Teardown
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Instructions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-destroy-application-administrator-account" class="md-nav__link">
    <span class="md-ellipsis">
      1. Destroy Application Administrator Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-destroy-microsoft-entra-id-resources-via-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      2. Destroy Microsoft Entra ID Resources via Terraform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-destroy-terraforms-global-administrator-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      3. Destroy Terraform's Global Administrator app registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-delete-cloud-shell-storage-account" class="md-nav__link">
    <span class="md-ellipsis">
      4. Delete Cloud Shell storage account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-delete-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      5. Delete subscription
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional Info
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact Info
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Instructions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-destroy-application-administrator-account" class="md-nav__link">
    <span class="md-ellipsis">
      1. Destroy Application Administrator Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-destroy-microsoft-entra-id-resources-via-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      2. Destroy Microsoft Entra ID Resources via Terraform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-destroy-terraforms-global-administrator-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      3. Destroy Terraform's Global Administrator app registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-delete-cloud-shell-storage-account" class="md-nav__link">
    <span class="md-ellipsis">
      4. Delete Cloud Shell storage account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-delete-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      5. Delete subscription
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="azure-teardown">Azure Teardown</h1>
<h2 id="objectives">Objectives</h2>
<ul>
<li>Destroy lab resources using Terraform</li>
<li>Delete the App Registration used for Terraform</li>
<li>Delete the Cloud Shell storage account</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>Once you've completed all of the Azure labs, you can (and should) tear down all of the lab resources. Aside from general tidiness and ensuring that you don't get surprised by any Azure usage fees, this wipes the slate clean so that you can - if you want - start the lab series from the beginnning!</p>
<h2 id="lab-preparation">Lab Preparation</h2>
<p>Before starting this lab, you should have already completed the <a href="../../a4/sec530.bonus.a4/" rel="noopener" target="_blank">Azure Privilege Escalation</a> lab. If you tear down the lab resources, you'll need to go back to the <a href="../../a2/sec530.bonus.a2/" rel="noopener" target="_blank">Azure Environment setup</a> lab.</p>
<div class="admonition reminder">
<p class="admonition-title">Current State</p>
<p>At this point, you should:</p>
<ul>
<li>
<p>Be logged into <a href="https://portal.azure.com" rel="noopener" target="_blank">https://portal.azure.com</a> with your Azure account.</p>
</li>
<li>
<p>Have created <a href="../../a2/sec530.bonus.a2/" rel="noopener" target="_blank">the test Microsoft Entra ID environment</a> replicating Tyrell Corp's fictitious production environment.</p>
</li>
<li>
<p>Have your own copy of the <a href="../../a1/sec530.bonus.a1/#7-open-azure-notes-workbook" rel="noopener" target="_blank">Azure-Notes workbook</a> open, recording information up to this point about your Azure account and Microsoft Entra ID environment.</p>
</li>
<li>
<p><strong>Be confident that you are ready to tear down the lab resources!</strong></p>
</li>
</ul>
</div>
<h2 id="step-by-step-instructions">Step-by-Step Instructions</h2>
<details class="example">
<summary>1. Delete Application Administrator Account</summary>
<h3 class="hidden_element" id="1-destroy-application-administrator-account">1. Destroy Application Administrator Account</h3>
<p>We're going to use Terraform to destroy most of the Microsoft Entra ID resources. However, the SP-Attack application - which is used by the Terraform client - may not have sufficient privileges to destroy the account that we escalated to Global Administrator. Rather than grant the SP-Attack overly broad privileges, we'll just delete that user account manually.</p>
<ol>
<li>
<p>Switch back to the browser tab accessing the Azure portal <a href="https://portal.azure.com" rel="noopener" target="_blank">https://portal.azure.com</a>.</p>
<div class="admonition cmd">
<p class="admonition-title">URL</p>
<div class="highlight"><pre><span></span><code>https://portal.azure.com
</code></pre></div>
</div>
</li>
<li>
<p>Navigate to the <strong>Users</strong> page.</p>
<p><strong>Click</strong> on the search bar at the top of the page, enter the text 'users', and select the <strong>Users</strong> service from the drop-down.</p>
<div class="admonition cmd">
<p class="admonition-title">Search Term</p>
<div class="highlight"><pre><span></span><code>users
</code></pre></div>
</div>
<p><img alt=" " class="noborder" src="../media/azure-users.png" /></p>
<p>The <strong>All users</strong> page should be presented by default.</p>
</li>
<li>
<p>Scroll down to find the user that was initially assigned the Application Administrator role, and we later escalated to Global Administrator. If you need to, refer to your Azure-Notes workbook and find the value recorded in the 'Application Admin Username' cell (cell B11).</p>
</li>
<li>
<p>Delete this user. <strong>Follow all of the prompts to confirm deletion.</strong></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">It may take a few minutes for deleted objects to be removed from the Azure portal pages. If you still see a deleted object after few minutes, then try to delete the object again.</p>
</div>
<div class="admonition success">
<p class="admonition-title">You have now deleted the user that was escalated to Global Administrator.</p>
</div>
</details>
<details class="example">
<summary>2. Destroy Microsoft Entra ID Resources via Terraform</summary>
<h3 class="hidden_element" id="2-destroy-microsoft-entra-id-resources-via-terraform">2. Destroy Microsoft Entra ID Resources via Terraform</h3>
<p>In this task, you'll use the Terraform client in your Cloud Shell bash shell to destroy all Microsoft Entra ID lab resources. This includes Microsoft Entra ID users, application registrations, and service principals.</p>
<ol>
<li>
<p>Since we're going to use the Terraform client, you need to change the Cloud Shell back to bash.</p>
<p><strong>Click</strong> on the <strong>Switch to Bash</strong> link in the top-left corner of the Cloud Shell terminal.</p>
<p><img alt=" " class="noborder" src="../../media/cloudshell-select-bash.png" /></p>
<p>You will be presented with a <strong>Switch to Bash in Cloud Shell</strong> prompt. <strong>Click</strong> on the <strong>Confirm</strong> command button.</p>
<p><img alt=" " class="noborder" src="../../media/cloudshell-confirm-bash.png" /></p>
<p>After a minute, your web browser tab will display a bash terminal prompt.</p>
<p><img alt=" " class="noborder" src="../../media/azure-cloud-shell-bash-prompt.png" /></p>
<div class="admonition note">
<p class="admonition-title">The standard Azure Cloud Shell prompt includes the account user name, and so will be different than the prompt in the screenshot above.</p>
</div>
<details class="tip">
<summary>Maximizing the Shell</summary>
<p>You can maximize the shell by <strong>clicking</strong> on the 'maximize' icon near the top-right of the terminal window.</p>
<p><img alt=" " class="noborder" src="../../media/azure-cloud-shell-maximize.png" /></p>
</details>
</li>
<li>
<p>Switch back to the Azure-Notes workbook.</p>
<p><strong>Select</strong> and <strong>copy</strong> cells D3:D8.</p>
<p>Switch back to the Cloud Shell bash shell and paste the cell contents.</p>
<p><img alt=" " class="noborder" src="../media/copy-arm-commands.png" /></p>
</li>
<li>
<p>Switch to your terminal window and <strong>paste</strong> the commands in. Your output should be similar to the following:</p>
<div class="admonition abstract">
<p class="admonition-title">Cloud Shell bash Output</p>
<div class="highlight"><pre><span></span><code>    [ ~ ]$ export ARM_SUBSCRIPTION_ID=&#39;7551c4d0-3cab-4286-a39d-f3964ecd9191&#39;
    export ARM_TENANT_ID=&#39;f6edcda7-02bc-4daa-972d-15567f6e3bb6&#39;
    export ARM_CLIENT_ID=&#39;ddb3c9bd-b976-41a8-9daa-6ad3e973c7b7&#39;
    export ARM_CLIENT_SECRET=&#39;1yT8Q~vP1OyGI~gOm3yvkwWQOhji-rPntKWd6b.u&#39;

    export DOMAIN=&#39;sansdevstudent79e4d10cee7f.onmicrosoft.com&#39;

    [ ~ ]
</code></pre></div>
</div>
</li>
<li>
<p>Change to the <code>~/azure</code> directory.</p>
<div class="admonition cmd">
<p class="admonition-title">Cloud Shell bash Input</p>
<div class="highlight"><pre><span></span><code>cd ~/azure
</code></pre></div>
</div>
<p>Your output should match the following:</p>
<div class="admonition abstract">
<p class="admonition-title">Cloud Shell bash Output</p>
<div class="highlight"><pre><span></span><code>[ ~ ]$ cd ~/azure

[ ~/azure ]$
</code></pre></div>
</div>
</li>
<li>
<p>Execute the command below to request destruction off all resources managed by the Terraform configuration files in the current directory.</p>
<div class="admonition cmd">
<p class="admonition-title">Cloud Shell bash Input</p>
<div class="highlight"><pre><span></span><code>terraform destroy
</code></pre></div>
</div>
<p>This command will generate many lines of output, detailing the resources that Terraform is going to destroy. Don't worry, you don't need to review it all for this lab!</p>
<div class="admonition note">
<p class="admonition-title">You can safely ignore any warnings about deprecated attributes, arguments, or resources.</p>
</div>
<p>The last of the output will match the following:</p>
<div class="admonition abstract">
<p class="admonition-title">Cloud Shell bash Output</p>
<div class="highlight"><pre><span></span><code>Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only &#39;yes&#39; will be accepted to confirm.

  Enter a value:
</code></pre></div>
</div>
<p>Enter 'yes' and press the <strong>Enter</strong> key.</p>
<p>This command may take a few minutes to complete, and will generate many lines of output.</p>
<div class="admonition note">
<p class="admonition-title">You can safely ignore any warnings about deprecated attributes, arguments, or resources.</p>
</div>
<p>When it is done, you should see a 'Destroy complete!' message with confirmation that resources have been destroyed.</p>
</li>
<li>
<p>Switch back to the Azure portal and refresh the <strong>Users</strong> page. You should see that all users created for the Azure labs have been deleted.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">It may take a few minutes for deleted objects to be removed from the Azure portal pages. If you still see a deleted object after few minutes, then try to delete the object again.</p>
</div>
<div class="admonition success">
<p class="admonition-title">The Terraform client has now destroyed the lab resources that were created with Terraform.</p>
</div>
</details>
<details class="example">
<summary>3. Destroy Terraform's Global Administrator app registration</summary>
<h3 class="hidden_element" id="3-destroy-terraforms-global-administrator-app-registration">3. Destroy Terraform's Global Administrator app registration</h3>
<p>The SP-Attack app registration used in these labs has significant privileges that could be abused with unauthorized access. It's important to delete this App registration if it is no longer required or being used.</p>
<ol>
<li>
<p>In the Azure portal, open the <strong>App registrations</strong> page to find the SP-Attack application.</p>
<p><strong>Click</strong> on the search bar at the top of the page, enter the text 'app registrations', and select the <strong>App rgistrations</strong> service from the drop-down.</p>
<div class="admonition cmd">
<p class="admonition-title">Search Term</p>
<div class="highlight"><pre><span></span><code>app registrations
</code></pre></div>
</div>
<p><img alt=" " class="noborder" src="../../media/azure-app-registrations.png" /></p>
</li>
<li>
<p>View the details of the SP-Attack application.</p>
<p>On the <strong>App registrations</strong> page, <strong>click</strong> on the <strong>All applications</strong> option to view all created applications, and then <strong>click</strong> on the icon for the <strong>SP-Attack</strong> application.</p>
<p><img alt=" " class="noborder" src="../../media/azure-view-applications.png" /></p>
</li>
<li>
<p><strong>Click</strong> on the <strong>Delete</strong> icon near the top of the page.</p>
<p><img alt=" " class="noborder" src="../media/azure-delete-sp-attack.png" /></p>
<p><strong>Follow all of the prompts to confirm deletion.</strong></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">It may take a few minutes for deleted objects to be removed from the Azure portal pages. If you still see a deleted object after few minutes, then try to delete the object again.</p>
</div>
<div class="admonition success">
<p class="admonition-title">The SP-Attack application, previously granted the Global Administrator role so that the Terraform could use it to manage Entra ID resources, as been deleted.</p>
</div>
</details>
<details class="example">
<summary>4. Delete Cloud Shell storage account</summary>
<h3 class="hidden_element" id="4-delete-cloud-shell-storage-account">4. Delete Cloud Shell storage account</h3>
<p>The Cloud Shell storage account can incur small costs over time even when it isn't used. The steps below walk through how to this account in the Azure portal.</p>
<ol>
<li>
<p>In the Azure portal, open the <strong>Storage accounts</strong> page.</p>
<p><strong>Click</strong> on the search bar at the top of the page, enter the text 'storage accounts', and select the <strong>Storage accounts</strong> service from the drop-down.</p>
<div class="admonition cmd">
<p class="admonition-title">Search Term</p>
<div class="highlight"><pre><span></span><code>storage accounts
</code></pre></div>
</div>
<p><img alt=" " class="noborder" src="../media/azure-storage-accounts.png" /></p>
</li>
<li>
<p><strong>Click</strong> on the storage account with a <strong>Resource group</strong> starting with <strong>cloud-shell-storage</strong>.  For new accounts, this should be the only row listed.</p>
<p><img alt=" " class="noborder" src="../media/azure-select-cloud-storage.png" /></p>
</li>
<li>
<p>On the <strong>cloud-shell-storage</strong> details page, <strong>click</strong> on the <strong>Delete</strong> icon near the top of the page.</p>
<p><img alt=" " class="noborder" src="../media/azure-delete-cloud-storage.png" /></p>
<p><strong>Follow all of the prompts to confirm deletion.</strong></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">It may take a few minutes for deleted objects to be removed from the Azure portal pages. If you still see a deleted object after few minutes, then try to delete the object again.</p>
</div>
<div class="admonition success">
<p class="admonition-title">This completes the last part of the teardown!</p>
</div>
</details>
<details class="example">
<summary>5. Delete subscription</summary>
<h3 class="hidden_element" id="5-delete-subscription">5. Delete subscription</h3>
<p>Assuming that you created a subscription specifically for this workshop, then you can also delete that subscription. The steps below walk through how to this account in the Azure portal.</p>
<ol>
<li>
<p><strong>Click</strong> on the search bar at the top of the page, enter the text 'subscriptions', and select the <strong>Subscriptions</strong> service from the drop-down.</p>
<div class="admonition cmd">
<p class="admonition-title">Search Text</p>
<div class="highlight"><pre><span></span><code>subscriptions
</code></pre></div>
</div>
<p><img alt=" " class="noborder" src="../../media/azure-subscription-service.png" /></p>
</li>
<li>
<p>Find the subscription that you are using for this workshop and <strong>click</strong> on the associated <strong>Subscription name</strong> to view the subscriptioion details.</p>
<p><img alt=" " class="noborder" src="../../media/azure-subscriptions-page-click.png" /></p>
</li>
<li>
<p>Near the top of the subscription details web page, <strong>click</strong> on the <strong>Cancel subscription</strong> option.</p>
<p><img alt=" " class="noborder" src="../media/azure-subscription-cancel.png" /></p>
<p><strong>Follow all of the prompts to confirm cancellation.</strong></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">It may take up to 10 minutes for a canceled subscription to marked as such on the Azure portal pages.</p>
</div>
<div class="admonition success">
<p class="admonition-title">This completes the last part of the teardown!</p>
</div>
</details>
<h2 id="conclusion">Conclusion</h2>
<p>This concludes the workshop's series of Azure labs. The lab environment is now cleaned up and ready for you to run through the labs again! <img alt="ðŸ˜" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f601.svg" title=":grin:" /></p>
<div class="admonition tip">
<p class="admonition-title">Consider Removing Your Credit Card Information!</p>
<p>If you don't have any active subscriptions and aren't planning on creating any in the near future, then I recommend you clean up your credit card information from your Azure account.</p>
<p>To clean up credit card information from an online service, I usually:</p>
<ul>
<li>First replace the credit card number with a virtual credit card number that has a $1 limit and an expiration date that is only a few months out.</li>
<li>Then remove the credit card information entirely, if the online service allows it.</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">How Do You Completely Delete an Azure Account?</p>
<p>Microsoft's guidance:<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<ul>
<li>Cancel and delete all subscriptions.</li>
<li>Remove all credit card information.</li>
<li>You can also delete the associated Microsoft Account, if it isn't being used for any other purpose.</li>
</ul>
</div>
<div class="admonition attention">
<p class="admonition-title">Watch Out for Fees!</p>
<p>New Azure accounts receive a Free Trial subscription with a $200 USD credit to use in the first 30 days, which is more than enough for this lab. But be mindful of fees that you may incur after the Free Trial subscription expires!</p>
</div>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Microsoft. (2024, March 13). <em>Cancel and delete your Azure subscription: How do I delete my Azure account?</em>. Microsoft Learn. Retrieved May 18, 2024 from <a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/cancel-azure-subscription#how-do-i-delete-my-azure-account" rel="noopener" target="_blank">https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/cancel-azure-subscription#how-do-i-delete-my-azure-account</a>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../a4/sec530.bonus.a4/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Privilege Escalation">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Privilege Escalation
              </div>
            </div>
          </a>
        
        
          
          <a href="../../info/" class="md-footer__link md-footer__link--next" aria-label="Next: Additional Info">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Additional Info
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Â©2024 Greg Scheidel
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cfa9459.min.js"></script>
      
    
  </body>
</html>